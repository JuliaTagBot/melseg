# Cosine similarity baseline

# using JLD
# isdefined(:data) || @load("groupedMelSegData.jld")

cosine(x,y) = dot(x,y)/(vecnorm(x)*vecnorm(y))

normal(x; mx=mean(x), sx=std(x)) = (x .- mx) ./ sx

cosnorm(x,y; o...) = cosine(normal(x; o...), normal(y; o...))

function allcos(xx,yy; o...)
    a = Float32[]
    for x in xx
        for y in yy
            push!(a, cosnorm(x,y; o...))
        end
    end
    return a
end

function printcos(data)
    q = [0,.25,.5,.75,1]
    for d in data
        isa(d["PerSegsTrue"],Void) && continue
        r1 = vcat(d["RefSegsTrue"]...)
        mx = mean(r1)
        sx = std(r1)
        println(quantile(allcos(d["RefSegsTrue"],d["RefSegsTrue"],mx=mx,sx=sx),q))
        println(quantile(allcos(d["RefSegsTrue"],d["PerSegsTrue"],mx=mx,sx=sx),q))
        println(quantile(allcos(d["RefSegsTrue"],d["PerSegsFalse"],mx=mx,sx=sx),q))
        println()
    end
end

# Output of printcos(data):

# Float32[0.51783,0.843342,0.898515,0.936384,1.0]
# Float32[0.281831,0.601221,0.722581,0.808675,0.955657]
# Float32[-0.528476,0.52987,0.683308,0.779417,0.927576]

# Float32[-0.417565,0.420223,0.641019,0.82493,1.0]
# Float32[-0.248075,0.108873,0.162213,0.335487,0.83023]
# Float32[-0.48789,-0.0693233,0.0767633,0.30544,0.889108]

# Float32[-0.274607,0.600598,0.778746,0.870678,1.0]
# Float32[-0.470661,0.524548,0.7144,0.815901,0.943585]
# Float32[-0.512623,0.0904965,0.32138,0.577408,0.908277]

# Float32[0.608947,0.866173,0.918163,0.946268,1.0]
# Float32[0.428327,0.78044,0.852204,0.898739,0.97381]
# Float32[-0.305821,0.394973,0.71889,0.808471,0.949947]

# Float32[0.430234,0.825169,0.883162,0.924848,1.0]
# Float32[0.0956748,0.554943,0.69163,0.81978,0.944336]
# Float32[-0.308146,0.438314,0.711019,0.793845,0.954038]

# Float32[0.321806,0.750683,0.84002,0.900515,1.0]
# Float32[0.100405,0.614332,0.735065,0.819915,0.962736]
# Float32[0.0353075,0.514158,0.649768,0.770142,0.938516]

# Float32[0.250692,0.802514,0.882671,0.9294,1.0]
# Float32[-0.140958,0.315888,0.760035,0.856603,0.963303]
# Float32[-0.628668,0.142457,0.505574,0.753477,0.947517]

# Float32[0.145144,0.629469,0.769253,0.871738,1.0]
# Float32[-0.196362,0.314905,0.529402,0.690695,0.940649]
# Float32[-0.604712,-0.0881434,0.371628,0.602275,0.917258]

# Float32[0.294274,0.70889,0.81317,0.88929,1.0]
# Float32[0.329316,0.709471,0.772187,0.833477,0.955523]
# Float32[-0.325076,0.389826,0.561363,0.675829,0.909722]

# Float32[0.286949,0.765829,0.853494,0.910613,1.0]
# Float32[0.17036,0.660064,0.7828,0.858932,0.953863]
# Float32[-0.674776,0.0588915,0.357284,0.719501,0.903627]

# Float32[0.360445,0.728305,0.82139,0.887689,1.0]
# Float32[0.451495,0.713871,0.804782,0.874524,0.949332]
# Float32[-0.0533012,0.421255,0.584092,0.723032,0.947801]

# Float32[0.0841178,0.583282,0.725749,0.826258,1.0]
# Float32[-0.0518345,0.0845716,0.143931,0.291672,0.683634]
# Float32[-0.380692,0.213723,0.343918,0.509993,0.922219]

# Float32[0.308682,0.746849,0.820015,0.879318,1.0]
# Float32[0.378033,0.685838,0.78525,0.858608,0.963286]
# Float32[-0.414857,0.149977,0.311626,0.541122,0.920682]

# Float32[0.533278,0.821617,0.881512,0.921837,1.0]
# Float32[0.392578,0.698664,0.790452,0.844808,0.952638]
# Float32[-0.5963,0.0910082,0.400182,0.794856,0.928753]

# Float32[0.643091,0.845797,0.894519,0.935809,1.0]
# Float32[-0.0705272,-0.0264076,-0.0110646,0.0237362,0.0863015]
# Float32[-0.605406,-0.0665198,0.294374,0.619856,0.88169]

# Float32[-0.0810161,0.429112,0.699983,0.827616,1.0]
# Float32[-0.0189678,0.0587066,0.281121,0.730419,0.943307]
# Float32[-0.7917,-0.0391697,0.139415,0.350606,0.868362]

# Float32[0.208546,0.671326,0.789261,0.862174,1.0]
# Float32[0.0571182,0.341359,0.433556,0.822178,0.929826]
# Float32[-0.399101,0.120124,0.282105,0.520031,0.803401]

# Float32[0.399047,0.797122,0.866454,0.915409,1.0]
# Float32[0.34736,0.562841,0.676371,0.796767,0.934049]
# Float32[-0.306154,0.190556,0.495839,0.659734,0.915149]

# Float32[0.633719,0.852629,0.894732,0.928784,1.0]
# Float32[-0.127642,-0.0774944,-0.0511268,-0.0208007,0.0557352]
# Float32[-0.52172,-0.0498513,0.079309,0.551165,0.90503]

# Float32[0.209224,0.670564,0.793241,0.883707,1.0]
# Float32[0.0703688,0.501442,0.6363,0.748235,0.965291]
# Float32[-0.253693,0.14136,0.398783,0.528235,0.899706]

# Float32[0.352818,0.866856,0.910514,0.946583,1.0]
# Float32[0.269033,0.68343,0.777905,0.821568,0.93462]
# Float32[-0.639206,0.254124,0.550059,0.738388,0.93474]

# Float32[0.256018,0.584986,0.705985,0.811057,1.0]
# Float32[0.110211,0.480432,0.62279,0.732447,0.943336]
# Float32[-0.407086,0.154326,0.396867,0.515015,0.859458]

# Float32[-0.177102,0.540115,0.72831,0.846759,1.0]
# Float32[-0.325715,0.270696,0.468592,0.687751,0.932782]
# Float32[-0.694876,-0.0509394,0.21477,0.508979,0.837127]

# Float32[0.413238,0.754692,0.842189,0.907146,1.0]
# Float32[-0.134084,0.523553,0.657909,0.751509,0.957077]
# Float32[-0.234611,0.43265,0.576692,0.694131,0.941075]

# Float32[0.16522,0.733814,0.827267,0.895219,1.0]
# Float32[0.095797,0.534112,0.724223,0.8293,0.949398]
# Float32[-0.510714,0.31645,0.45511,0.604286,0.891072]

# Float32[0.125046,0.558113,0.720568,0.84261,1.0]
# Float32[0.0820815,0.413827,0.577948,0.712663,0.951903]
# Float32[-0.397263,0.0877374,0.339798,0.483134,0.921224]

# Float32[0.597537,0.77237,0.849037,0.911701,1.0]
# Float32[0.270412,0.620787,0.681177,0.757054,0.950191]
# Float32[-0.216431,0.381294,0.596779,0.650016,0.902907]

# Float32[0.289887,0.754108,0.854132,0.916598,1.0]
# Float32[0.0517729,0.595549,0.705233,0.825866,0.958469]
# Float32[-0.350919,0.392623,0.594915,0.713161,0.94204]

# Float32[0.622863,0.854053,0.906569,0.942579,1.0]
# Float32[0.584877,0.730615,0.815238,0.879687,0.982877]
# Float32[0.243019,0.550825,0.636882,0.788584,0.966161]

# Float32[0.0864844,0.678707,0.813338,0.907985,1.0]
# Float32[0.462249,0.790146,0.865742,0.904563,0.95724]
# Float32[-0.199216,0.338543,0.600747,0.758231,0.926958]

# Float32[0.212164,0.656818,0.807896,0.901439,1.0]
# Float32[0.246509,0.706877,0.822019,0.878912,0.957814]
# Float32[-0.150007,0.159957,0.494455,0.649792,0.911291]

# Float32[0.415903,0.66202,0.778553,0.877506,1.0]
# Float32[0.369278,0.592971,0.716744,0.840488,0.94605]
# Float32[0.0135101,0.351836,0.481143,0.636292,0.916417]

# Float32[0.555317,0.850503,0.90208,0.935524,1.0]
# Float32[-0.16492,0.750758,0.842921,0.897972,0.966333]
# Float32[-0.260984,0.476758,0.743343,0.808493,0.95907]

# Float32[0.210637,0.75971,0.857757,0.926666,1.0]
# Float32[-0.021836,0.707973,0.776229,0.864274,0.974328]
# Float32[0.257579,0.572664,0.712575,0.787581,0.893648]

# Float32[0.493405,0.811113,0.879992,0.922542,1.0]
# Float32[0.343702,0.678016,0.749672,0.825126,0.954717]
# Float32[0.0793594,0.31623,0.504254,0.714104,0.940022]

# Float32[0.0768921,0.63624,0.781214,0.866409,1.0]
# Float32[0.158472,0.619118,0.723303,0.801102,0.91985]
# Float32[-0.412722,0.0460212,0.330416,0.524561,0.800956]

# Float32[0.531199,0.817854,0.874247,0.91973,1.0]
# Float32[0.613064,0.791686,0.854856,0.900375,0.971927]
# Float32[-0.0387285,0.489283,0.654501,0.766355,0.951595]

# Float32[0.361937,0.709528,0.799786,0.891958,1.0]
# Float32[0.193897,0.584114,0.698858,0.786687,0.944286]
# Float32[-0.145143,0.267834,0.64085,0.759461,0.884658]

# Float32[0.252463,0.642773,0.77884,0.884377,1.0]
# Float32[0.115067,0.584067,0.733906,0.823004,0.942661]
# Float32[-0.44058,0.0329857,0.483374,0.705563,0.913877]
